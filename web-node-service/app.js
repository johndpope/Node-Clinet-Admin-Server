(function(e){function t(r){if(a[r])return a[r].exports;var l=a[r]={i:r,l:!1,exports:{}};return e[r].call(l.exports,l,l.exports,t),l.l=!0,l.exports}var a={};return t.m=e,t.c=a,t.d=function(e,a,r){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var a=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(a,'a',a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=31)})([function(e){e.exports=require('babel-runtime/regenerator')},function(e){e.exports=require('babel-runtime/helpers/asyncToGenerator')},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}var l=a(0),o=r(l),d=a(1),s=r(d),n=a(41),u=a(42);n.configure(u);var i=function(e){return n.getLogger(e)};e.exports={logFile:i,httpHead:function(){var e=i();return function(){var t=(0,s.default)(o.default.mark(function t(a,r){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.info('method:',a.method),e.info('url:',a.originalUrl),e.info('ip:',a.request.ip),t.next=5,r();case 5:case'end':return t.stop();}},t,this)}));return function(){return t.apply(this,arguments)}}()}}},function(e){'use strict';/*!
 * consts.js v1.0.0
 * 常量列表js，主要是用来存一些常量，避免大家都各自在各个地方定义常量，便于统一管理<br>
 * 缓存的前缀和key需要注意，不能重复，所以，缓存的前缀，大家尽量按照模块名称来取，保证前缀不重复，例如登录的相关信息，前缀都用login
 * key也都在这里统一定义，这样就可以很明确的知道那些名字已经被占用了，已经存在了。
 * Author:
 * Date:
 * 使用方法：
 *        import consts from common/consts.js
 *        consts.ERROR_CODE.SUCCESS
 */e.exports={ERROR_CODE:{SUCCESS:1e4,UNKNOWN_ERROR:2e4,SIGNATURE_ERROR:20004,SERVICE_NOTEXISTS:20005,PARAM_NULL:20001,PARAM_TYPE_ERROR:20006,PARAM_FORMAT_ERROR:20007,PARAM_OVER_ERROR:20003,PARAM_NULL_ERROR:20013,INTERNAL_SERVER_ERROR:20008,DATA_FORMAT_ERROR:20009,PARAM_LENGTH_OVER:20010,CHECK_ALREADY_EXISTS:20011,NO_ACCESS_TOKEN:61003,NO_SECURITY_ID:61004,PHONENUM_OCCUPY:61005,ALREADY_EXIST:61006,SEND_CODE_FAIL:61007,INSTANCE_ID_NO_SECURITY_ID:61011,INSTANCE_ID_NO_ACCESS_TOKEN:61012,CODE_EXPIRED:61013,INNER_ERROR:61014,PROGRAM_ERROR:61015,GRAPHICAL_ERROE:61016,CODE_ERROR:61017,UNAUTHORIZED_ACCESS:61018,NO_OBJECT:61019,USERNAME_OR_PASS_ERRROR:61020,ACCOUNT_CANCELLATION:61024,ACCOUNT_CODE_EXPIRED:61025},ACCESSTOKEN:'access_token',ROUTER:{GET:[],POST:[]}}},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}var l=a(0),o=r(l),d=a(1),s=r(d),n=a(17),u=r(n),i=a(11),p=r(i),f=a(18),c=r(f),_=a(19),R=r(_),E=a(2),m=E.logFile('error-code'),y=a(3),x=a(25),O=a(12),h=function(e){function t(e){(0,p.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,u.default)(t)).call(this));return e&&e.meg&&(a.meg=e.meg),e&&e.errorCode&&(a.errorCode=e.errorCode),a}return(0,R.default)(t,e),t}(Error),g=function(e){function t(e,a){(0,p.default)(this,t);var r=(0,c.default)(this,(t.__proto__||(0,u.default)(t)).call(this)),l=x(e);return r.errorCode=l.error_code||e,r.meg=a||l.error_message,r}return(0,R.default)(t,e),t}(h),S=function(e){function t(e){(0,p.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,u.default)(t)).call(this));return a.errorCode=y.ERROR_CODE.PARAM_NULL,a.meg='\u53C2\u6570\u9519\u8BEF',e&&e.meg&&(a.meg=e.meg),e&&e.errorCode&&(a.errorCode=e.errorCode),a}return(0,R.default)(t,e),t}(h);e.exports={HttpException:h,erroeException:g,ParametersException:S,catchError:function(){return function(){var e=(0,s.default)(o.default.mark(function e(t,a){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a();case 3:404==t.status&&(m.info('404\uFF1A\u9519\u8BEF\u5730\u5740'),t.body={error_code:y.ERROR_CODE.SERVICE_NOTEXISTS,error_message:'404 \u670D\u52A1\u5730\u5740\u4E0D\u5B58\u5728',request:t.url}),e.next=10;break;case 6:e.prev=6,e.t0=e['catch'](0),m.info('\u670D\u52A1\u5668\u5F02\u5E38',e.t0),t.body=O.resultData(e.t0.errorCode,e.t0.data,e.t0.meg);case 10:case'end':return e.stop();}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}()},catchHead:function(){return function(){var e=(0,s.default)(o.default.mark(function e(t,a){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return m.info('method:',t.method),m.info('url:',t.url),m.info('ip:',t.request.ip),t.data='POST'===t.method?t.request.body:t.request.query,e.next=6,a();case 6:case'end':return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()}}},function(e){'use strict';e.exports='progress'==process.env.BRANCH_ENV?{port:8081,database:{DATABASE:'skd',USERNAME:'root',PASSWORD:'123456',PORT:'3306',HOST:'127.0.0.1'},upload:{UPLOAD:'/upload',IMAGE:'/image/',FILE:'/file/',MAXFILESIZE:209715200},secretKey:'ffggfhjtwefcv',expiresIn:86400}:{port:8081,database:{DATABASE:'skd',USERNAME:'root',PASSWORD:'123456',PORT:'3306',HOST:'127.0.0.1'},upload:{UPLOAD:'/upload',IMAGE:'/image/',FILE:'/file/',MAXFILESIZE:209715200},secretKey:'ffggfhjtwefcv',expiresIn:360000}},function(e){e.exports=require('babel-runtime/helpers/defineProperty')},function(e,t,a){'use strict';/*!
 * utils v1.0.0
 * 工具类,提供各种工具方法，会陆续添加
 *
 * Author: liaoxm
 * Date: 2019-07-22
 *
 */function r(e){return e&&e.__esModule?e:{default:e}}function l(e){var t={};for(var a in e)t[a]='object'===(0,y.default)(e[a])?l(e[a]):e[a];return t}var o=a(43),d=r(o),s=a(44),n=r(s),u=a(45),i=r(u),p=a(46),f=r(p),c=a(24),_=r(c),R=a(10),E=r(R),m=a(47),y=r(m),x=a(48),O=function(e,t,a){var r=x.createHash(e),l=Buffer.isBuffer(t);return l||'object'!==('undefined'==typeof t?'undefined':(0,y.default)(t))||(t=(0,E.default)(h(t))),r.update(t,l?'binary':'utf8'),r.digest(a||'hex')},h=function e(t){if(!t||Array.isArray(t)||'object'!==('undefined'==typeof t?'undefined':(0,y.default)(t)))return t;var a=(0,_.default)(t);a.sort();for(var r,l=[],d=0;d<a.length;d++)r=a[d],l.push([r,e(t[r])]);return l},g=function(e,t){return t&&t.prefix&&(e=e.filter(function(e){return e.toString().startsWith(t.prefix)})),t&&t.filter&&(e=e.filter(t.filter)),e};e.exports={offset:function(e,a){var r={};if(a=a?a:!!e.offsetParent&&e.offsetParent,!a)return r.left=0,r.top=0,r;for(var o=0,l=0,t=e;a!=t;){if(t.offsetParent!=a)o+=t.offsetLeft,l+=t.offsetTop;else{o+=t.offsetLeft,l+=t.offsetTop;break}t=t.offsetParent}return r.left=o,r.top=l,r},query:function(e){return document.querySelector(e)},queryAll:function(e){return document.querySelectorAll(e)},sortObject:h,base64decode:function(e,t){var a=new Buffer(e,'base64');return'buffer'===t?a:a.toString(t||'utf8')},base64encode:function(e){Buffer.isBuffer(e)||(e=new Buffer(e));var t=e.toString('base64');return!1,t},sha256:function(e,t){return O('sha256',e,t)},sha1:function(e,t){return O('sha1',e,t)},md5:function(e,t){return O('md5',e,t)},clone:function e(t){var a;switch('undefined'==typeof t?'undefined':(0,y.default)(t)){case'undefined':break;case'string':a=t+'';break;case'number':a=t-0;break;case'boolean':a=t;break;case'object':if(null===t)a=null;else if(t instanceof Array){a=[];for(var r=0,l=t.length;r<l;r++)a.push(e(t[r]))}else for(var o in a={},t)a[o]=e(t[o]);break;default:a=t;}return a},getQueryString:function(e){var t=new RegExp('(^|&)'+e+'=([^&]*)(&|$)','i'),a=window.location.search.substr(1).match(t);return null==a?null:unescape(a[2])},deepCopy:l,aesEncode:function(e,t){var a=x.createCipher('aes192',t),r=a.update(e,'utf8','hex');return r+=a.final('hex'),r},aesDecode:function(e,t){var a=x.createDecipher('aes192',t),r=a.update(e,'hex','utf8');return r+=a.final('utf8'),r},bubbleSort:function(e,t){if(null==e)return null;for(var a=0;a<e.length;a++)for(var r=0;r<e.length-a-1;r++)if(e[r][t]-0>e[r+1][t]-0){var l=e[r+1];e[r+1]=e[r],e[r]=l}return e},processKeyAndData:function(e,t,a,r){var l,o=a?/([A-Z])/g:/_(.)/g,d=a?''.toLocaleLowerCase:''.toLocaleUpperCase;for(var s in t)r&&-1==r.indexOf(s)||(l=s.replace(o,function(){return a?'_'+d.call(arguments[1]):d.call(arguments[1])}),e[l]=t[s])},tofixed:function(e){return e=e||'0.00',parseFloat(e.toString()).toFixed(2)},objectType:function(e,t){var a=Object.prototype.toString,r=a.call(e);return r=r.substring(8,r.length-1),t&&r==t,r},time:function(){return Date.parse(new Date)/1e3},getAllFieldNames:function(e,t){var a=(0,n.default)(e);return g(a,t)},getAllMethodNames:function(e,t){for(var a=new f.default;e=(0,i.default)(e);){var r=(0,n.default)(e);r.forEach(function(e){return a.add(e)})}var l=(0,d.default)(a.values());return g(l,t)},typeOf:function(e){var t=Object.prototype.toString;return{"[object Boolean]":'boolean',"[object Number]":'number',"[object String]":'string',"[object Function]":'function',"[object Array]":'array',"[object Date]":'date',"[object RegExp]":'regExp',"[object Undefined]":'undefined',"[object Null]":'null',"[object Object]":'object'}[t.call(e)]}}},function(e,t,a){'use strict';var r=a(10),l=function(e){return e&&e.__esModule?e:{default:e}}(r),o=a(14),d=a(5),s=a(49),n=a(2),u=n.logFile('sequelize-mysql');u.info('sequelize-log_start start!');var i=new o(d.database.DATABASE,d.database.USERNAME,d.database.PASSWORD,{host:d.database.HOST,dialect:'mysql',pool:{max:5,min:0,idle:1e4},define:{timestamps:!1}});i.authenticate().then(function(){u.info('sequelize-log_start start!')}).catch(function(e){u.error('Unable to connect to the database:',(0,l.default)(e)),s.sendEmail('shanyanwt@163.com','Mysql-error','shanyanwt@163.com','Mysql \u8FDE\u63A5\u5931\u8D25','<p>\u9519\u8BEF\u4FE1\u606F: </p>'+(0,l.default)(e)+'<p>\u8BF7\u4F60\u53CA\u65F6\u5904\u7406</p >').then(function(){u.info('mysql\u9519\u8BEF\u90AE\u7BB1\u63D0\u793A\u53D1\u9001\u6210\u529F\uFF01')}).catch(function(e){u.error('mysql\u9519\u8BEF\u90AE\u7BB1\u63D0\u793A\u53D1\u9001\u5931\u8D25\uFF01',e)})}),e.exports={db:i,Admin:a(51)(i,o),Article:a(52)(i,o),Role:a(53)(i,o),Star:a(54)(i,o),MysqlSessionStore:a(55)(i,o)}},function(e){e.exports=require('babel-runtime/helpers/extends')},function(e){e.exports=require('babel-runtime/core-js/json/stringify')},function(e){e.exports=require('babel-runtime/helpers/classCallCheck')},function(e,t,a){'use strict';var r=a(10),l=function(e){return e&&e.__esModule?e:{default:e}}(r),o=a(4),d=a(3),s=a(25),n=a(2),u=n.logFile('extend_mssage');e.exports={success:function(e){var t={error_code:d.ERROR_CODE.SUCCESS,error_message:'\u670D\u52A1\u8C03\u7528\u6210\u529F',Data:e};return u.info((0,l.default)(t)),t},resultData:function(e,t,a){var r=s(e),o={error_code:r.error_code||e,error_message:a||r.error_message};return t&&(o.Data=t),u.info((0,l.default)(o)),o}}},function(e){e.exports=require('babel-runtime/helpers/toConsumableArray')},function(e){e.exports=require('sequelize')},function(e,t,a){'use strict';(function(t){var r=a(2),l=r.logFile(t);e.exports={validation:function(e){if('SequelizeValidationError'==e.name){var t=[];return e.errors.map(function(e){t.push(e.path+':'+e.validatorKey)}),l.error('SequelizeValidationError'),l.error(e.message),t.join(',')}return l.error(e),e}}}).call(t,'/')},function(e){e.exports=require('babel-runtime/core-js/promise')},function(e){e.exports=require('babel-runtime/core-js/object/get-prototype-of')},function(e){e.exports=require('babel-runtime/helpers/possibleConstructorReturn')},function(e){e.exports=require('babel-runtime/helpers/inherits')},function(e){e.exports=require('babel-runtime/helpers/createClass')},function(e){e.exports=require('path')},function(e){e.exports=require('lodash')},function(e){e.exports=require('fs')},function(e){e.exports=require('babel-runtime/core-js/object/keys')},function(e,t,a){'use strict';var r=a(22),l=[{error_code:1e4,error_message:'\u670D\u52A1\u5668\u8C03\u7528\u6210\u529F'},{error_code:2e4,error_message:'\u672A\u77E5\u9519\u8BEF'},{error_code:20001,error_message:' \u5FC5\u586B\u53C2\u6570\u4E3A\u7A7A'},{error_code:20002,error_message:'headers appname \u5FC5\u586B\u4E0D\u80FD\u4E3A\u7A7A'},{error_code:20003,error_message:' \u8BF7\u6C42\u53C2\u6570\u6570\u503C\u8D85\u51FA\u4E1A\u52A1\u8303\u56F4'},{error_code:20004,error_message:'\u7B7E\u540D\u9519\u8BEF'},{error_code:20006,error_message:'\u53C2\u6570\u7C7B\u578B\u9519\u8BEF'},{error_code:20005,error_message:' 404\u670D\u52A1\u4E0D\u5B58\u5728'},{error_code:20007,error_message:'\u53C2\u6570\u683C\u5F0F\u9519\u8BEF'},{error_code:20008,error_message:'\u670D\u52A1\u51FA\u73B0\u4E86\u70B9\u95EE\u9898\uFF0C\u7A0D\u540E\u91CD\u8BD5'},{error_code:20009,error_message:'\u4F20\u5165\u7684JSON\u6570\u636E\u683C\u5F0F\u9519\u8BEF'},{error_code:20010,error_message:'\u53C2\u6570\u6570\u636E\u8D85\u8FC7\u5141\u8BB8\u957F\u5EA6'},{error_code:20011,error_message:'\u6570\u636E\u5DF2\u5B58\u5728\u8BF7\u52FF\u91CD\u590D\u63D0\u4EA4'},{error_code:61003,error_message:'access_token\u4E0D\u5B58\u5728'},{error_code:61004,error_message:'security_id\u4E0D\u5B58\u5728'},{error_code:61005,error_message:'\u624B\u673A\u53F7\u5DF2\u88AB\u4F7F\u7528'},{error_code:61006,error_message:'\u53D1\u9001\u77ED\u4FE1\u9A8C\u8BC1\u7801\u6210\u529F'},{error_code:61007,error_message:'\u53D1\u9001\u77ED\u4FE1\u9A8C\u8BC1\u7801\u5931\u8D25'},{error_code:61011,error_message:'instance_id\u548Csecurity_id\u4E0D\u5339\u914D'},{error_code:61012,error_message:' instance_id\u548Caccess_token\u4E0D\u5339\u914D'},{error_code:61013,error_message:'\u77ED\u4FE1\u9A8C\u8BC1\u7801\u4E0D\u6B63\u786E\u6216\u5DF2\u8FC7\u671F'},{error_code:61014,error_message:'\u77ED\u4FE1\u9A8C\u8BC1\u7801\uFF0C\u5185\u90E8\u9519\u8BEF'},{error_code:61015,error_message:'\u7A0B\u5E8F\u5E8F\u5217\u9519\u8BEF'},{error_code:61016,error_message:'\u56FE\u5F62\u9A8C\u8BC1\u7801\u9519\u8BEF'},{error_code:61017,error_message:'\u77ED\u4FE1\u9A8C\u8BC1\u7801\u9519\u8BEF'},{error_code:61018,error_message:'\u65E0\u6743\u8BBF\u95EE'},{error_code:61019,error_message:'\u5BF9\u8C61\u4E0D\u5B58\u5728'},{error_code:61020,error_message:'\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF'},{error_code:61024,error_message:' \u8D26\u53F7\u5DF2\u6CE8\u9500'},{error_code:61025,error_message:'access_token\u5DF2\u8FC7\u671F'}];/*!
 * errorMessag.js v1.0.0
 * Author:
 * Date:
 * 使用方法：
 *         const require('ustils/errorMessag.js')
 * 			errorMessag(code)
 */e.exports=function(e){var t=r.filter(l,{error_code:e||20008});return t[0]}},function(e){e.exports=require('jsonwebtoken')},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}var l=a(13),o=r(l),d=a(24),s=r(d),n=a(61),u=r(n),i=a(0),p=r(i),f=a(28),c=r(f),_=a(62),R=r(_),E=a(1),m=r(E),y=a(11),x=r(y),O=a(20),h=r(O),g=a(22),S=a(4),N=a(29),T=a(63),b=a(7),A=function(){function e(){(0,x.default)(this,e),this.data={},this.parsed={},this.errors=[]}return(0,h.default)(e,[{key:'validate',value:function(){var e=(0,m.default)(p.default.mark(function e(t,a){var r,l,o,d,s,n,u,i;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.alias=a,this.data={body:t.request.body,query:t.request.query,path:t.params,header:t.request.header,auth:t.auth||null},r=g.cloneDeep(this.data),this.parsed=(0,R.default)({},r,{default:{}}),e.next=6,this.checkRules();case 6:if(e.sent){e.next=34;break}if(l={},1!==this.errors.length){e.next=12;break}l=this.errors[0].message,e.next=31;break;case 12:for(o=!0,d=!1,s=void 0,e.prev=15,n=(0,c.default)(this.errors);!(o=(u=n.next()).done);o=!0)i=u.value,l[i.key]=i.message;e.next=23;break;case 19:e.prev=19,e.t0=e['catch'](15),d=!0,s=e.t0;case 23:e.prev=23,e.prev=24,!o&&n.return&&n.return();case 26:if(e.prev=26,!d){e.next=29;break}throw s;case 29:return e.finish(26);case 30:return e.finish(23);case 31:throw new S.ParametersException({meg:l});case 34:return t.v=this,e.abrupt('return',this);case 36:case'end':return e.stop();}},e,this,[[15,19,23,31],[24,,26,30]])}));return function(){return e.apply(this,arguments)}}()},{key:'replace',value:function(e){if(!this.alias)return e;var t=[],a=!0,r=!1,l=void 0;try{for(var o,d,s=(0,c.default)(e);!(a=(o=s.next()).done);a=!0)d=o.value,this.alias[d]?(this[this.alias[d]]=this[d],g.unset(this,d),t.push(this.alias[d])):t.push(d)}catch(e){r=!0,l=e}finally{try{!a&&s.return&&s.return()}finally{if(r)throw l}}return t}},{key:'isOptional',value:function(e){return void 0===e||null===e||'string'==typeof e&&(''===e||''===e.trim())}},{key:'checkRules',value:function(){var e=(0,m.default)(p.default.mark(function e(){var t,a,r,l,o,d,s,n,i,f,_,R,E,m,y,x,O,h,N,T,A,C,v,I,w,D,V,M,L,F,P,U,G,q,j,K,H,X,B,W,z,Y,Z,Q,J=this;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=b.getAllFieldNames(this,{filter:function(e){var t=J[e];if(g.isArray(t)){if(0===t.length)return!1;var a=!0,r=!1,l=void 0;try{for(var o,d,s=(0,c.default)(t);!(a=(o=s.next()).done);a=!0)if(d=o.value,!(d instanceof k))throw new Error('every item must be a instance of Rule')}catch(e){r=!0,l=e}finally{try{!a&&s.return&&s.return()}finally{if(r)throw l}}return!0}return t instanceof k}}),t=this.replace(t),a=!0,r=!1,l=void 0,e.prev=5,o=(0,c.default)(t);case 7:if(a=(d=o.next()).done){e.next=90;break}if(s=d.value,n=!1,i=!1,f=this[s],_=void 0,R=this.findInData(s),E=(0,u.default)(R,2),m=E[0],y=E[1],!this.isOptional(y)){e.next=42;break}if(x=void 0,!g.isArray(f)){e.next=38;break}for(O=!0,h=!1,N=void 0,e.prev=20,T=(0,c.default)(f);!(O=(A=T.next()).done);O=!0)C=A.value,C.optional?(_=C.defaultValue&&C.defaultValue,i=!0):!x&&(x=C.message);e.next=28;break;case 24:e.prev=24,e.t0=e['catch'](20),h=!0,N=e.t0;case 28:e.prev=28,e.prev=29,!O&&T.return&&T.return();case 31:if(e.prev=31,!h){e.next=34;break}throw N;case 34:return e.finish(31);case 35:return e.finish(28);case 36:e.next=39;break;case 38:f.optional?(_=f.defaultValue&&f.defaultValue,i=!0):x=f.message;case 39:i?this.parsed['default'][s]=_:this.errors.push({key:s,message:x||s+'\u4E0D\u53EF\u4E3A\u7A7A'}),e.next=87;break;case 42:if(!g.isArray(f)){e.next=78;break}v=[],I=!0,w=!1,D=void 0,e.prev=47,V=(0,c.default)(f);case 49:if(I=(M=V.next()).done){e.next=61;break}if(L=M.value,n||L.optional){e.next=57;break}return F=void 0,e.next=55,L.validate(this.data[m][s]);case 55:F=e.sent,F||(v.push(L.message),n=!0);case 57:void 0!==L.parsedValue&&(this.parsed[m][s]=L.parsedValue);case 58:I=!0,e.next=49;break;case 61:e.next=67;break;case 63:e.prev=63,e.t1=e['catch'](47),w=!0,D=e.t1;case 67:e.prev=67,e.prev=68,!I&&V.return&&V.return();case 70:if(e.prev=70,!w){e.next=73;break}throw D;case 73:return e.finish(70);case 74:return e.finish(67);case 75:0!==v.length&&this.errors.push({key:s,message:v}),e.next=87;break;case 78:if(P=[],n||f.optional){e.next=85;break}return U=void 0,e.next=83,f.validate(this.data[m][s]);case 83:U=e.sent,U||(P.push(f.message),n=!0);case 85:void 0!==f.parsedValue&&(this.parsed[m][s]=f.parsedValue),0!==P.length&&this.errors.push({key:s,message:P});case 87:a=!0,e.next=7;break;case 90:e.next=96;break;case 92:e.prev=92,e.t2=e['catch'](5),r=!0,l=e.t2;case 96:e.prev=96,e.prev=97,!a&&o.return&&o.return();case 99:if(e.prev=99,!r){e.next=102;break}throw l;case 102:return e.finish(99);case 103:return e.finish(96);case 104:G=b.getAllMethodNames(this,{filter:function(e){return /validate([A-Z])\w+/g.test(e)&&'function'==typeof J[e]}}),q=!0,j=!1,K=void 0,e.prev=108,H=(0,c.default)(G);case 110:if(q=(X=H.next()).done){e.next=128;break}return B=X.value,W=g.get(this,B),z=void 0,e.prev=114,e.next=117,W.call(this,this.data);case 117:z=e.sent,g.isArray(z)&&!z[0]?(Y=void 0,Y=z[2]?z[2]:this.getValidateFuncKey(B),this.errors.push({key:Y,message:z[1]})):!z&&(Z=this.getValidateFuncKey(B),this.errors.push({key:Z,message:'\u53C2\u6570\u9519\u8BEF'})),e.next=125;break;case 121:e.prev=121,e.t3=e['catch'](114),Q=this.getValidateFuncKey(B),e.t3 instanceof S.HttpException?this.errors.push({key:Q,message:e.t3.meg}):this.errors.push({key:Q,message:e.t3.message});case 125:q=!0,e.next=110;break;case 128:e.next=134;break;case 130:e.prev=130,e.t4=e['catch'](108),j=!0,K=e.t4;case 134:e.prev=134,e.prev=135,!q&&H.return&&H.return();case 137:if(e.prev=137,!j){e.next=140;break}throw K;case 140:return e.finish(137);case 141:return e.finish(134);case 142:return e.abrupt('return',0===this.errors.length);case 143:case'end':return e.stop();}},e,this,[[5,92,96,104],[20,24,28,36],[29,,31,35],[47,63,67,75],[68,,70,74],[97,,99,103],[108,130,134,142],[114,121],[135,,137,141]])}));return function(){return e.apply(this,arguments)}}()},{key:'getValidateFuncKey',value:function(e){return e.replace('validate','')}},{key:'get',value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],a=void 0;if(3<=arguments.length&&(a=arguments[2]),t){var r=g.get(this.parsed,e,a&&a);if(!this.isOptional(r))return r;var l=e.lastIndexOf('.'),o=e.substring(l+1,e.length);return g.get(this.parsed['default'],o,a&&a)}return g.get(this.data,e,a&&a)}},{key:'findInData',value:function(e){var t=(0,s.default)(this.data),a=!0,r=!1,l=void 0;try{for(var o,d=(0,c.default)(t);!(a=(o=d.next()).done);a=!0){var n=o.value,u=g.get(this.data[n],e);if(void 0!==u)return[n,u]}}catch(e){r=!0,l=e}finally{try{!a&&d.return&&d.return()}finally{if(r)throw l}}return[]}}]),e}();t.XValidator=A;var k=function(){function e(t,a){(0,x.default)(this,e),this.optional=!1,this.validateFunction=t,this.message=a||'\u53C2\u6570\u9519\u8BEF';for(var r=arguments.length,l=Array(2<r?r-2:0),o=2;o<r;o++)l[o-2]=arguments[o];this.options=l,'isOptional'===this.validateFunction&&(this.optional=!0,this.defaultValue=l&&l[0])}return(0,h.default)(e,[{key:'validate',value:function(e){var t;if(this.rawValue=e,'function'==typeof this.validateFunction)return this.validateFunction.apply(this,[e].concat((0,o.default)(this.options)));switch(this.validateFunction){case'isInt':if('string'==typeof e){var a;return this.parsedValue=N.default.toInt(e),(a=N.default).isInt.apply(a,[e].concat((0,o.default)(this.options)))}var r;return this.parsedValue=e,(r=N.default).isInt.apply(r,[e+''].concat((0,o.default)(this.options)));case'isFloat':if('string'==typeof e){var l;return this.parsedValue=N.default.toFloat(e),(l=N.default).isFloat.apply(l,[e].concat((0,o.default)(this.options)))}var d;return this.parsedValue=e,(d=N.default).isFloat.apply(d,[e+''].concat((0,o.default)(this.options)));case'isBoolean':return'string'==typeof e?(this.parsedValue=N.default.toBoolean(e),N.default.isBoolean(e)):(this.parsedValue=e,N.default.isBoolean(e+''));case'isNotEmpty':return T.extendedValidator.isNotEmpty(e);default:return(t=N.default)[this.validateFunction].apply(t,[e].concat((0,o.default)(this.options)));}}}]),e}();t.Rule=k},function(e){e.exports=require('babel-runtime/core-js/get-iterator')},function(e){e.exports=require('validator')},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}var l=a(0),o=r(l),d=a(16),s=r(d),n=a(1),u=r(n),p=a(23),i=function(){var e=(0,u.default)(o.default.mark(function e(t){var a,r,l,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.name,r=t.type,l=t.newName,d=t.txt,e.abrupt('return',new s.default(function(e,t){switch(r){case'stat':p.stat(a,function(a,r){return a?(t(a),!1):void e(r)});break;case'mkdir':p.mkdir(a,function(a){return a?(t(a),!1):void e(1)});break;case'writeFile':p.writeFileSync(a,d,'utf8',function(a){return a?(t(a),!1):void e(1)});break;case'appendFile':p.appendFile(a,d,'utf8',function(a){return a?(t(a),!1):void e(1)});break;case'readFile':p.readFile(a,'utf8',function(a,r){return a?(t(a),!1):void e(r)});break;case'readdir':p.readdir(a,function(a,r){return a?(t(a),!1):void e(r)});break;case'rename':p.rename(a,l,function(a){return a?(t(a),!1):void e(1)});break;case'rmdir':p.rmdir(a,function(a){return a?(t(a),!1):void e(1)});break;case'unlink':p.unlink(a,function(a){return a?(t(a),!1):void e(1)});break;case'createReadStream':var o=p.createReadStream(a),s='';o.on('data',function(e){s+=e}),o.on('end',function(){e(s)}),o.on('error',function(e){t(e)});break;case'createWriteStream':var n=d,u=p.createWriteStream(a);u.write(n,'UTF8'),u.end(),u.on('finish',function(){e(1)}),u.on('error',function(e){t(e)});break;case'pipe':var i=p.createReadStream(a),u=p.createWriteStream(l);i.pipe(u),u.on('finish',function(){e(l)}),u.on('error',function(e){t(e)});break;case'access':p.access('package.json',function(t){e(t)});break;case'mkdirFile':var f=a.split('/'),c='';f.forEach(function(a,r){a&&(c+='/'+a,!p.existsSync(c)&&p.mkdirSync(c,function(e){t(e)}),f.length-2==r&&e(1))});}}));case 2:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports={fileUtils:i}},function(e,t,a){'use strict';var r=a(32),l=a(33),o=a(34),d=a(35),s=a(36),n=a(37),u=a(21),i=a(5),p=a(38),f=a(2),c=a(4),_=c.catchHead,R=c.catchError,E=a(75),m=new r,y={user:i.database.USERNAME,password:i.database.PASSWORD,database:i.database.DATABASE,host:i.database.HOST};m.use(d({key:'USER_SID',store:new s(y)})),m.use(l({formLimit:'1mb',multipart:!0,formidable:{maxFileSize:i.upload.MAXFILESIZE,keepExtensions:!0}})),m.use(o()),m.use(n(u.join(i.upload.UPLOAD))),m.use(R()),m.use(_()),m.use(E()),m.use(p()),m.listen(i.port),console.log('listening on port '+i.port)},function(e){e.exports=require('koa')},function(e){e.exports=require('koa-body')},function(e){e.exports=require('koa-cors')},function(e){e.exports=require('koa-session-minimal')},function(e){e.exports=require('koa-mysql-session')},function(e){e.exports=require('koa-static')},function(e,t,a){'use strict';function r(e,t){for(var a in t)if(a.startsWith('GET ')){var r=n+a.substring(4);e.get(r,t[a]),d.ROUTER.GET.push(r),s.info('register URL mapping: GET '+r)}else if(a.startsWith('POST ')){var r=n+a.substring(5);e.post(r,t[a]),d.ROUTER.POST.push(r),s.info('register URL mapping: POST '+r)}else s.info('invalid URL: '+a)}var l=a(39),o=a(2),d=a(3),s=o.logFile('router'),n='/article/v1/';e.exports=function(e){var t=a(74)();return r(t,l),t.routes()}},function(e,t,a){'use strict';var r=a(9),l=function(e){return e&&e.__esModule?e:{default:e}}(r);e.exports=(0,l.default)({},a(40),a(56),a(59),a(65),a(67),a(70),a(72))},function(e,t,a){'use strict';(function(t){function r(e){return e&&e.__esModule?e:{default:e}}var l,o=a(6),d=r(o),s=a(13),n=r(s),u=a(0),i=r(u),p=a(9),f=r(p),c=a(1),_=r(c),R=a(14).Op,E=a(3),m=a(15),y=a(7),x=a(8).Article,O=a(4),h=a(12),g=a(2),S=g.logFile(t),N=function(){var e=(0,_.default)(i.default.mark(function e(t){var a,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,r=Date.parse(new Date)/1e3,e.next=4,x.create((0,f.default)({},a,{create_time:r,update_time:r})).then(function(e){t.body=h.success(e)}).catch(function(e){throw new O.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 4:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),T=function(){var e=(0,_.default)(i.default.mark(function e(t){var a,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,r=Date.parse(new Date)/1e3,a.map(function(e){e.create_time=r,e.update_time=r}),e.next=5,x.bulkCreate([].concat((0,n.default)(a))).then(function(e){t.body=h.success(e)}).catch(function(e){throw new O.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 5:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),b=function(){var e=(0,_.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.findOne({where:{id:t.params.id}}).then(function(e){t.body=h.success(e)}).catch(function(e){throw new O.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 2:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),A=function(){var e=(0,_.default)(i.default.mark(function e(t){var a,r,l,o,s,u,p,c,_,g,N,T,b,A,k,C,v;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,r=a.where,l=void 0===r?{}:r,o=a.order,s=void 0===o?[['create_time','DESC']]:o,u=a.keyword,p=a.id,c=a.title,_=a.status,g=a.type,N=a.order_key,T=a.start_date,b=a.end_date,A=a.row_start,k=void 0===A?0:A,C=a.row_count,v=void 0===C?10:C,(p||0===p)&&(l.id=p),c&&(l.title=(0,d.default)({},R.like,'%'+c+'%')),(_||0===_)&&(l.status=_),(g||0===g)&&(l.type=g),T&&b&&(l.create_time=(0,d.default)({},R.between,[T,b])),u&&(l[R.or]=[{title:(0,d.default)({},R.like,'%'+u+'%')},{content:(0,d.default)({},R.like,'%'+u+'%')},{summary:(0,d.default)({},R.like,'%'+u+'%')},{classify:(0,d.default)({},R.like,'%'+u+'%')}]),N&&y.objectType(N,'Array')&&(s=N),e.next=10,x.findAndCountAll({where:l,order:[].concat((0,n.default)(s)),offset:parseInt(k),limit:parseInt(v)}).then(function(e){var a=(0,f.default)({},h.success({items:e.rows}),{total_row:e.count||0});t.body=a}).catch(function(e){throw S.error(e),new O.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 10:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),k=function(){var e=(0,_.default)(i.default.mark(function e(t){var a,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,r=Date.parse(new Date)/1e3,e.next=4,x.update((0,f.default)({},a,{update_time:r}),{where:{id:a.id}}).then(function(e){var a=e[0]?E.ERROR_CODE.SUCCESS:E.ERROR_CODE.INTERNAL_SERVER_ERROR,r=e[0]?'\u66F4\u65B0\u5B8C\u6210':'\u66F4\u65B0\u5931\u8D25';t.body=h.resultData(a,r)}).catch(function(e){throw new O.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 4:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),C=function(){var e=(0,_.default)(i.default.mark(function e(t){var a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.params.id,e.next=3,x.destroy({where:{id:a}}).then(function(e){t.body=h.success(e)}).catch(function(e){throw new O.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 3:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports=(l={},(0,d.default)(l,'POST add',N),(0,d.default)(l,'POST add_list',T),(0,d.default)(l,'GET select/:id',b),(0,d.default)(l,'POST article_list',A),(0,d.default)(l,'POST search',A),(0,d.default)(l,'POST update',k),(0,d.default)(l,'GET del/:id',C),l)}).call(t,'/')},function(e){e.exports=require('log4js')},function(e){e.exports={pm2:!0,disableClustering:!0,appenders:{access:{type:'dateFile',filename:'/logs/access.log',pattern:'-yyyy-MM-dd'},"rule-console":{type:'console'},"rule-error":{type:'dateFile',filename:'/logs/error-',encoding:'utf-8',maxLogSize:1e6,numBackups:3,pattern:'yyyy-MM-dd.log',alwaysIncludePattern:!0}},categories:{default:{appenders:['rule-console','rule-error'],level:'debug'},http:{appenders:['access'],level:'info'}}}},function(e){e.exports=require('babel-runtime/core-js/array/from')},function(e){e.exports=require('babel-runtime/core-js/reflect/own-keys')},function(e){e.exports=require('babel-runtime/core-js/reflect/get-prototype-of')},function(e){e.exports=require('babel-runtime/core-js/set')},function(e){e.exports=require('babel-runtime/helpers/typeof')},function(e){e.exports=require('crypto')},function(e,t,a){'use strict';var r=a(16),l=function(e){return e&&e.__esModule?e:{default:e}}(r),o=a(50);e.exports={sendEmail:function(e,t,a,r,d){return new l.default(function(l,s){var n=o.createTransport({service:'163',secureConnection:!0,secure:!0,port:465,auth:{user:e,pass:'yanjiang123'}});n.sendMail({from:t+' <'+e+'>',to:a,subject:r,html:d},function(e){e?s(e):l()})})}}},function(e){e.exports=require('nodemailer')},function(e){'use strict';e.exports=function(e,t){return e.define('skd_admin',{id:{type:t.INTEGER(11),allowNull:!1,primaryKey:!0,autoIncrement:!0},role_id:{type:t.INTEGER(11),allowNull:!0},name:{type:t.STRING(255),allowNull:!1},phone:{type:t.STRING(255),allowNull:!0},email:{type:t.STRING(255),allowNull:!0},password:{type:t.STRING(255),allowNull:!0},qq:{type:t.STRING(255),allowNull:!0},sex:{type:t.STRING(255),allowNull:!0},content:{type:t.TEXT,allowNull:!0},status:{type:t.INTEGER(4),allowNull:!0,defaultValue:'0'},create_time:{type:t.STRING(20),allowNull:!0},update_time:{type:t.STRING(20),allowNull:!0},last_login_time:{type:t.DATE,allowNull:!0}},{tableName:'skd_admin',timestamps:!1})}},function(e){'use strict';e.exports=function(e,t){return e.define('skd_article',{id:{type:t.INTEGER(11),allowNull:!1,primaryKey:!0,autoIncrement:!0},user_ip:{type:t.STRING(20),allowNull:!0},email:{type:t.STRING(30),allowNull:!0},title:{type:t.STRING(255),allowNull:!1},content:{type:t.TEXT,allowNull:!0},summary:{type:t.STRING(255),allowNull:!0,defaultValue:''},cover:{type:t.STRING(100),allowNull:!0},classify:{type:t.STRING(100),allowNull:!0},type:{type:t.INTEGER(4),allowNull:!1},status:{type:t.INTEGER(4),allowNull:!0,defaultValue:'0'},star_number:{type:t.INTEGER(10),allowNull:!0,defaultValue:'0'},number:{type:t.INTEGER(20),allowNull:!0,defaultValue:'0'},create_time:{type:t.STRING(20),allowNull:!0},update_time:{type:t.STRING(20),allowNull:!0}},{tableName:'skd_article',timestamps:!1})}},function(e){'use strict';e.exports=function(e,t){return e.define('skd_role',{id:{type:t.INTEGER(11),allowNull:!1,primaryKey:!0,autoIncrement:!0},article_id:{type:t.STRING(255),allowNull:!1},content:{type:t.TEXT,allowNull:!0},status:{type:t.INTEGER(4),allowNull:!0,defaultValue:'0'},create_time:{type:t.DATE,allowNull:!0},update_time:{type:t.DATE,allowNull:!0}},{tableName:'skd_role',timestamps:!1})}},function(e){'use strict';e.exports=function(e,t){return e.define('skd_star',{id:{type:t.INTEGER(11),allowNull:!1,primaryKey:!0,autoIncrement:!0},article_id:{type:t.INTEGER(11),allowNull:!1},admin_id:{type:t.INTEGER(11),allowNull:!1},status:{type:t.INTEGER(4),allowNull:!0,defaultValue:'1'},create_time:{type:t.STRING(20),allowNull:!0},update_time:{type:t.STRING(20),allowNull:!0}},{tableName:'skd_star',timestamps:!1})}},function(e){'use strict';e.exports=function(e,t){return e.define('_mysql_session_store',{id:{type:t.STRING(255),allowNull:!1,primaryKey:!0,autoIncrement:!0},expires:{type:t.BIGINT,allowNull:!0},data:{type:t.TEXT,allowNull:!0}},{tableName:'_mysql_session_store',timestamps:!1})}},function(e,t,a){'use strict';(function(t){function r(e){return e&&e.__esModule?e:{default:e}}var l,o=a(9),d=r(o),s=a(6),n=r(s),u=a(13),i=r(u),p=a(0),f=r(p),c=a(1),_=r(c),R=a(14).Op,E=a(3),m=a(15),y=a(57),x=a(7),O=a(8).Admin,h=a(58),g=h.token,S=h.auth,N=a(4),T=a(12),b=a(2),A=b.logFile(t),k=function(){var e=(0,_.default)(f.default.mark(function e(t){var a,r,l,o,d,s,n,u,i,p,c,_,R,y,h,g,S,b,A,k,C,v,I,w;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,r=a.role_id,l=void 0===r?null:r,o=a.email,d=void 0===o?null:o,s=a.user_ticket,n=void 0===s?null:s,u=a.name,i=void 0===u?null:u,p=a.phone,c=void 0===p?null:p,_=a.qq,R=void 0===_?null:_,y=a.sex,h=void 0===y?null:y,g=a.content,S=void 0===g?null:g,b=a.status,A=void 0===b?0:b,k=a.create_time,C=void 0===k?x.time():k,v=a.update_time,I=void 0===v?x.time():v,e.next=3,O.findOne({where:{name:i}});case 3:if(w=e.sent,!w){e.next=6;break}throw new N.erroeException(E.ERROR_CODE.CHECK_ALREADY_EXISTS,'\u8BE5\u7528\u6237\u5DF2\u5B58\u5728');case 6:return e.next=8,O.create({role_id:l,email:d,password:n,name:i,phone:c,qq:R,sex:h,content:S,status:A,create_time:C,update_time:I}).then(function(e){t.body=T.success(e)}).catch(function(e){throw new N.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 8:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),C=function(){var e=(0,_.default)(f.default.mark(function e(t){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.findOne({where:{name:t.params.name}}).then(function(e){t.body=T.success({is_user:e?1:0})}).catch(function(e){throw new N.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 2:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),v=function(){var e=(0,_.default)(f.default.mark(function e(t){var a;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,e.next=3,O.findOne({where:{name:a.name}}).then(function(e){if(e){1==e.status&&(t.body=T.resultData(E.ERROR_CODE.ACCOUNT_CANCELLATION));var r=e.password,l=x.md5(r+a.timestamp);l==a.user_ticket?(e.setDataValue([E.ACCESSTOKEN],g(e)),e.setDataValue('password',null),t.body=T.success(e)):t.body=T.resultData(E.ERROR_CODE.USERNAME_OR_PASS_ERRROR)}else t.body=T.resultData(E.ERROR_CODE.USERNAME_OR_PASS_ERRROR)}).catch(function(e){throw new N.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 3:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),I=function(){var e=(0,_.default)(f.default.mark(function e(t){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.findByPk.apply(O,(0,i.default)(t.params.id)).then(function(e){t.body=T.success(e)}).catch(function(e){throw new N.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 2:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),w=function(){var e=(0,_.default)(f.default.mark(function e(t){var a,r,l,o,s,u,i,p,c,_,x,h,g,S,b;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,r=a.where,l=void 0===r?{}:r,o=a.id,s=a.name,u=a.phone,i=a.email,p=a.qq,c=a.start_date,_=a.end_date,x=a.status,h=a.row_start,g=void 0===h?0:h,S=a.row_count,b=void 0===S?10:S,(o||0===o)&&(l.id=o),s&&(l.name=(0,n.default)({},R.like,'%'+s+'%')),u&&(l.phone=(0,n.default)({},R.like,'%'+u+'%')),i&&(l.email=(0,n.default)({},R.like,'%'+i+'%')),p&&(l.qq=(0,n.default)({},R.like,'%'+p+'%')),(x||0===x)&&(l.status=x),c&&_&&(l.create_time=(0,n.default)({},R.between,[c,_])),e.next=10,O.findAndCountAll((0,d.default)({},y.user,{where:l,order:[['create_time','DESC']],offset:parseInt(g),limit:parseInt(b)})).then(function(e){var a=(0,d.default)({},T.success({items:e.rows}),{total_row:e.count||0});t.body=a}).catch(function(e){throw A.error(e),new N.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 10:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),D=function(){var e=(0,_.default)(f.default.mark(function e(t){var a,r,l;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Date.parse(new Date)/1e3,r=t.data,l={role_id:r.role_id,email:r.email,name:r.name,phone:r.phone,password:r.user_ticket,qq:r.qq,sex:r.sex,content:r.content,update_time:a,last_login_time:r.last_login_time},(r.status||0===r.status)&&(l.status=r.status),e.next=6,O.update((0,d.default)({},l),{where:{id:r.id}}).then(function(){t.body=T.success()}).catch(function(e){throw new N.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 6:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),V=function(){var e=(0,_.default)(f.default.mark(function e(t){var a;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.params.id,e.next=3,O.destroy({where:{id:a}}).then(function(e){var a={error_code:E.ERROR_CODE.SUCCESS,Data:{is_user:e}};t.body=a}).catch(function(e){throw new N.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 3:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports=(l={},(0,n.default)(l,'POST admin_add',k),(0,n.default)(l,'GET admin_select/:id',I),(0,n.default)(l,'GET admin_check/:name',C),(0,n.default)(l,'POST admin_login',v),(0,n.default)(l,'POST admin_list',w),(0,n.default)(l,'POST admin_update',D),(0,n.default)(l,'GET admin_del/:id',V),l)}).call(t,'/')},function(e){'use strict';e.exports={user:{attributes:{exclude:['password','ip']}}}},function(e,t,a){'use strict';var r=a(26),l=a(5),o=a(4),d=a(7);e.exports={token:function(e){var t=l.secretKey,a=l.expiresIn,o=r.sign({user:e},t,{expiresIn:a});return o}}},function(e,t,a){'use strict';(function(t){function r(e){return e&&e.__esModule?e:{default:e}}var l,o=a(6),d=r(o),s=a(13),n=r(s),u=a(0),i=r(u),p=a(9),f=r(p),c=a(1),_=r(c),R=a(14).Op,E=a(3),m=a(15),y=a(7),x=a(8).db,O=a(8).Star,h=a(8).Article,g=a(8).Admin,S=a(4),N=a(12),T=a(60),b=T.starValidator,A=a(2),k=A.logFile(t),C=function(){var e=(0,_.default)(i.default.mark(function e(t){var a,r,l,o;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,r=Date.parse(new Date)/1e3,e.next=4,new b().validate(t);case 4:return l=e.sent,e.next=7,O.count({where:{article_id:l.get('body.article_id'),admin_id:l.get('body.admin_id')}});case 7:if(o=e.sent,!o){e.next=10;break}throw new S.erroeException(E.ERROR_CODE.CHECK_ALREADY_EXISTS);case 10:return e.abrupt('return',x.transaction(function(){var e=(0,_.default)(i.default.mark(function e(o){var d;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.create((0,f.default)({},a,{create_time:r,update_time:r}),{transaction:o}).catch(function(e){throw new Error(e)});case 2:return e.next=4,h.update({star_number:x.literal('`star_number` +1'),update_time:r},{where:{id:l.get('body.article_id')},transaction:o}).catch(function(e){throw new Error(e)});case 4:if(d=e.sent,!d){e.next=9;break}return e.abrupt('return',d);case 9:throw new Error('\u66F4\u65B0\u5931\u8D25');case 10:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}()).then(function(){t.body=N.success({isAdd:1})}).catch(function(e){throw k.error(e),new S.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR)}));case 11:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),v=function(){var e=(0,_.default)(i.default.mark(function e(t){var a,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,r=Date.parse(new Date)/1e3,a.map(function(e){e.create_time=r,e.update_time=r}),e.next=5,O.bulkCreate([].concat((0,n.default)(a))).then(function(e){t.body=N.success(e)}).catch(function(e){throw new S.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 5:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),I=function(){var e=(0,_.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.findOne({where:{id:t.params.id}}).then(function(e){t.body=N.success(e)}).catch(function(e){throw new S.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 2:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();O.belongsTo(h,{foreignKey:'article_id',as:'article'});var w=function(){var e=(0,_.default)(i.default.mark(function e(t){var a,r,l,o;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,r=Date.parse(new Date)/1e3,e.next=4,new b().validate(t);case 4:return l=e.sent,e.next=7,O.findAll({include:[{model:h,as:'article'}],where:{admin_id:l.get('body.admin_id')}});case 7:o=e.sent,t.body=N.success(o);case 9:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),D=function(){var e=(0,_.default)(i.default.mark(function e(t){var a,r,l,o,s,u,p,c,_,x,h,g,T,b,A,C,v;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,r=a.where,l=void 0===r?{}:r,o=a.order,s=void 0===o?[['create_time','DESC']]:o,u=a.keyword,p=a.id,c=a.title,_=a.status,x=a.type,h=a.order_key,g=a.start_date,T=a.end_date,b=a.row_start,A=void 0===b?0:b,C=a.row_count,v=void 0===C?10:C,(p||0===p)&&(l.id=p),c&&(l.title=(0,d.default)({},R.like,'%'+c+'%')),(_||0===_)&&(l.status=_),(x||0===x)&&(l.type=x),g&&T&&(l.create_time=(0,d.default)({},R.between,[g,T])),u&&(l[R.or]=[{title:(0,d.default)({},R.like,'%'+u+'%')},{content:(0,d.default)({},R.like,'%'+u+'%')},{summary:(0,d.default)({},R.like,'%'+u+'%')},{classify:(0,d.default)({},R.like,'%'+u+'%')}]),h&&y.objectType(h,'Array')&&(s=h),e.next=10,O.findAndCountAll({where:l,order:[].concat((0,n.default)(s)),offset:parseInt(A),limit:parseInt(v)}).then(function(e){var a=(0,f.default)({},N.success({items:e.rows}),{total_row:e.count||0});t.body=a}).catch(function(e){throw k.error(e),new S.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 10:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),V=function(){var e=(0,_.default)(i.default.mark(function e(t){var a,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,r=Date.parse(new Date)/1e3,e.next=4,O.update((0,f.default)({},a,{update_time:r}),{where:{id:a.id}}).then(function(e){var a=e[0]?E.ERROR_CODE.SUCCESS:E.ERROR_CODE.INTERNAL_SERVER_ERROR,r=e[0]?'\u66F4\u65B0\u5B8C\u6210':'\u66F4\u65B0\u5931\u8D25';t.body=N.resultData(a,r)}).catch(function(e){throw new S.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 4:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),M=function(){var e=(0,_.default)(i.default.mark(function e(t){var a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.params.id,e.next=3,O.destroy({where:{id:a}}).then(function(e){t.body=N.success(e)}).catch(function(e){throw new S.erroeException(E.ERROR_CODE.INTERNAL_SERVER_ERROR,m.validation(e))});case 3:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports=(l={},(0,d.default)(l,'POST star/add',C),(0,d.default)(l,'POST star/add_list',v),(0,d.default)(l,'GET star/select/:id',I),(0,d.default)(l,'POST star/star_list',D),(0,d.default)(l,'POST star/search',D),(0,d.default)(l,'POST star/update',V),(0,d.default)(l,'GET star/del/:id',M),(0,d.default)(l,'POST star/user',w),l)}).call(t,'/')},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}var l=a(17),o=r(l),d=a(11),s=r(d),n=a(20),u=r(n),i=a(18),p=r(i),f=a(19),c=r(f),_=a(27),R=_.XValidator,E=_.Rule,m=function(e){function t(){(0,s.default)(this,t);var e=(0,p.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return e.article_id=new E('isNotEmpty','\u6587\u7AE0ID\u4E0D\u53EF\u4E3A\u7A7A'),e}return(0,c.default)(t,e),(0,u.default)(t,[{key:'validateRepeat',value:function(e){var t=e.auth.user?e.auth.user.id:null;return!!t||[!1,'\u7528\u6237\u4FE1\u606F\u4E0D\u5B58\u5728']}}]),t}(R);e.exports={starValidator:m}},function(e){e.exports=require('babel-runtime/helpers/slicedToArray')},function(e){e.exports=require('babel-runtime/core-js/object/assign')},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}var l=a(28),o=r(l),d=a(17),s=r(d),n=a(11),u=r(n),i=a(20),p=r(i),f=a(18),c=r(f),_=a(19),R=r(_),E=a(64),m=a(22),y=a(29),x=function(e){function t(){return(0,u.default)(this,t),(0,c.default)(this,(t.__proto__||(0,s.default)(t)).apply(this,arguments))}return(0,R.default)(t,e),(0,p.default)(t,[{key:'hasProperty',value:function(e,t){return m.has(e,t)}},{key:'objPropertyIsNotEmpty',value:function(e,t){return!!this.hasProperty(e,t)&&this.isNotEmpty(m.get(e,t))}},{key:'objPropertiesIsNotEmpty',value:function(e,t){var a=!0,r=!1,l=void 0;try{for(var d,s,n=(0,o.default)(t);!(a=(d=n.next()).done);a=!0){if(s=d.value,!this.hasProperty(e,s))return!1;if(!this.isNotEmpty(m.get(e,s)))return!1}}catch(e){r=!0,l=e}finally{try{!a&&n.return&&n.return()}finally{if(r)throw l}}return!0}},{key:'toInt',value:function(e,t){return y.default.toInt(e,t)}},{key:'toFloat',value:function(e){return y.default.toFloat(e)}},{key:'toBoolean',value:function(e){return y.default.toBoolean(e)}},{key:'toDate',value:function(e){return y.default.toDate(e)}},{key:'isFloat',value:function(e,t){return y.default.isFloat(e,t)}},{key:'isFloat2',value:function(e,t){return y.default.isFloat(e+'',t)}},{key:'isInt2',value:function(e,t){return y.default.isInt(e,t)}},{key:'isInt3',value:function(e,t){return y.default.isInt(e+'',t)}}]),t}(E.Validator);t.ExtendedValidator=x,t.extendedValidator=new x},function(e){e.exports=require('class-validator')},function(e,t,a){'use strict';(function(t){function r(e){return e&&e.__esModule?e:{default:e}}var l=a(6),o=r(l),d=a(0),s=r(d),n=a(1),u=r(n),i=a(23),p=a(21),f=a(3),c=a(66),_=a(5),R=a(2),E=R.logFile(t),m=a(30),y=m.fileUtils,x=function(){var e=(0,u.default)(s.default.mark(function e(t){var a,r,l,o,d,n,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Date.parse(new Date),r='SDK_'+c.dateFormat(a,c.ISO8601_WITH_TZ_OFFSET_FORMAT),l=t.request.files.file,o=_.upload.UPLOAD+_.upload.IMAGE,d=r.substring(4,8)+'/'+r.substring(8,10),n='blob'==l.name?'png':l.name.split('.').pop(),u=p.join(o,d,r+'.'+n),e.next=9,y({type:'mkdirFile',name:o+d});case 9:return e.next=11,y({type:'pipe',name:l.path,newName:u}).then(function(e){var a=e.substring(_.upload.UPLOAD.length,e.length);t.body={error_code:f.ERROR_CODE.SUCCESS,error_message:'\u4E0A\u4F20\u6587\u4EF6\u6210\u529F',realName:a}}).catch(function(e){E.error(e),t.body={error_code:f.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25\uFF01'}});case 11:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports=(0,o.default)({},'POST upload',x)}).call(t,'/')},function(e){'use strict';/*!
 * dateFormat.js v1.0.0
 * 日期格式化工具类
 *
 * Author: liaoxm
 * Date: 2016-06-16
 *
 */function t(e,t){for(var a=e+'';a.length<t;)a='0'+a;return a}function a(e){return t(e,2)}function r(e){var t=Math.abs(e),a=Math.floor(t/60)+'',r=t%60+'';return 1===a.length&&(a='0'+a),1===r.length&&(r='0'+r),0>e?'+'+a+r:'-'+a+r}var l='yyyy-MM-dd hh:mm:ss';e.exports={dateFormat:function(e,o,d){if(!e)return e;('string'==typeof e||'number'==typeof e)&&(e=new Date(arguments[0]),o=arguments[1],d=arguments[2]),o===void 0&&(o=l),d===void 0&&(d=e.getTimezoneOffset()),e.setUTCMinutes(e.getUTCMinutes()-d);var s=a(e.getUTCDate()),n=a(e.getUTCMonth()+1),u=a(e.getUTCFullYear()),i=a(e.getUTCFullYear().toString().substring(2,4)),p=-1<o.indexOf('yyyy')?u:i,f=a(e.getUTCHours()),c=a(e.getUTCMinutes()),_=a(e.getUTCSeconds()),R=t(e.getUTCMilliseconds(),3),E=r(d);e.setUTCMinutes(e.getUTCMinutes()+d);var m=o.replace(/dd/g,s).replace(/MM/g,n).replace(/y{1,4}/g,p).replace(/hh/g,f).replace(/mm/g,c).replace(/ss/g,_).replace(/SSS/g,R).replace(/O/g,E);return m},ISO8601_FORMAT:l,ISO8601_FORMAT_WITHOUT_TIME:'yyyy-MM-dd',ISO8601_WITH_TZ_OFFSET_FORMAT:'yyyyMMddhhmmss',DATETIME_FORMAT:'dd MM yyyy hh:mm:ss.SSS',ABSOLUTETIME_FORMAT:'hh:mm:ss.SSS'}},function(e,t,a){'use strict';(function(t){function r(e){return e&&e.__esModule?e:{default:e}}function l(e,t,a){var r=E.readdirSync(t);r.forEach(function(r){var o=t+'/'+r,d=E.statSync(o);if(d.isDirectory()){var s=o.replace(a,''),n=b.folder(s);l(n,o,a)}else e.file(r,E.readFileSync(o))})}var o,d=a(6),s=r(d),n=a(0),u=r(n),i=a(10),p=r(i),f=a(1),c=r(f),_=a(16),R=r(_),E=a(23),m=a(21),y=a(68),x=a(69),O=a(3),h=a(30),g=h.fileUtils,S=a(5),N=a(2),T=N.logFile(t),b=new x,A=[],k=function(e){return new R.default(function(t,a){E.readdir(e,function(r,l){r?a(r):0==l.length?t(A):l.forEach(function(r,o){var d=m.join(e,r);E.stat(d,function(e,r){return e?(a(e),!1):void(r.isDirectory()&&(A.push({name:l[o],type:1}),l.length==A.length&&t(A)),r.isFile()&&(A.push({name:l[o],type:0}),l.length==A.length&&t(A)))})})})})},C=function(){var e=(0,c.default)(u.default.mark(function e(t){var a,r,l;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return A=[],a=t.data,r=a.path||S.upload.UPLOAD,l=m.resolve(r),e.next=6,k(l).then(function(e){var a=[];e.map(function(e){var t={path:r+'/'+e.name,name:e.name,type:e.type};a.push(t)});var l={error_code:O.ERROR_CODE.SUCCESS,Data:{items:a,path:r}};T.info((0,p.default)(l)),t.body=l}).catch(function(e){T.error(e);var a={error_code:O.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u670D\u52A1\u5668\u5F02\u5E38'};t.body=a});case 6:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),v=function(){var e=(0,c.default)(u.default.mark(function e(t){var a,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.data,a.path){e.next=6;break}return T.error(err),r={error_code:O.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u8BF7\u8F93\u5165\u6587\u4EF6\u540D\u79F0'},t.body=r,e.abrupt('return',!1);case 6:return e.next=8,g({type:a.type?'rmdir':'unlink',name:a.path}).then(function(){var e={error_code:O.ERROR_CODE.SUCCESS,Data:{ischeck:1}};T.info((0,p.default)(e)),t.body=e}).catch(function(e){T.error(e);var a={error_code:O.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u670D\u52A1\u5668\u5F02\u5E38'};return t.body=a,!1});case 8:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),I=function(){var e=(0,c.default)(u.default.mark(function e(t){var a,r,o,d,s,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.query,a.path){e.next=6;break}return T.error(err),r={error_code:O.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u8BF7\u8F93\u5165\u6587\u4EF6\u540D\u79F0'},t.body=r,e.abrupt('return',!1);case 6:if(o={},1!=a.type){e.next=23;break}return d=a.path.split('/'),s=d[d.length-1],n='/upload/temp/',e.next=13,l(b,a.path,a.path);case 13:return e.next=15,g({type:'mkdirFile',name:n});case 15:return e.next=17,b.generateAsync({type:'nodebuffer',compression:'DEFLATE',compressionOptions:{level:9}}).then(function(e){g({type:'writeFile',name:''+n+s+'.zip',txt:e}).then(function(){T.info('\u538B\u7F29\u6210\u529F\uFF01')}).catch(function(e){T.error(e);var a={error_code:O.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u670D\u52A1\u5668\u5F02\u5E38'};return t.body=a,!1})});case 17:return e.next=19,y(t,''+n+s+'.zip',{root:'/'});case 19:return e.next=21,g({type:'unlink',name:''+n+s+'.zip'}).then(function(){T.info('\u6E05\u9664\u6587\u4EF6\u6210\u529F\uFF01')}).catch(function(e){T.error('\u5220\u9664\u6587\u4EF6\u5931\u8D25',e)});case 21:e.next=25;break;case 23:return e.next=25,y(t,a.path,{root:'/'});case 25:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports=(o={},(0,s.default)(o,'POST file_catalogue',C),(0,s.default)(o,'POST del_file',v),(0,s.default)(o,'GET download_file',I),o)}).call(t,'/')},function(e){e.exports=require('koa-send')},function(e){e.exports=require('jszip')},function(e,t,a){'use strict';(function(t){function r(e){return e&&e.__esModule?e:{default:e}}var l=a(6),o=r(l),d=a(10),s=r(d),n=a(0),u=r(n),i=a(16),p=r(i),f=a(1),c=r(f),_=a(71),R=a(3),E=a(5),m=a(2),y=m.logFile(t),x=function(){var e=(0,c.default)(u.default.mark(function e(t){var a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a='http://music.163.com/api/playlist/detail?id='+t,e.abrupt('return',new p.default(function(e,t){_.get(a,function(t){var a='';t.on('data',function(e){a+=e}),t.on('end',function(){e(a)})}).on('error',function(a){t(a)})}));case 2:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),O=function(){var e=(0,c.default)(u.default.mark(function e(t){var a,r,l;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a='http://music.163.com/song/media/outer/url?id=',r=t.params.id,r||(y.error('\u8BF7\u586B\u5199ID'),l={error_code:R.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u8BF7\u586B\u5199ID'},t.body=l),e.next=5,x(r).then(function(e){if(e=JSON.parse(e),200!=e.code)throw new Error('Sync Error');var r=[];(e.result.tracks||[]).map(function(e){var t={name:e.name,artist:e.artists?e.artists[0].name:'\u97F3\u4E50\u662F\u4E16\u754C\u7684',id:e.id,cover:e.album?e.album.picUrl:'http://p1.music.126.net/6y-UleORITEDbvrOLV0Q8A==/5639395138885805.jpg',url:''+a+e.id+'.mp3 '};r.push(t)});var l={error_code:R.ERROR_CODE.SUCCESS,Data:{items:r}};y.info((0,s.default)(l)),t.body=l}).catch(function(e){y.error(e);var a={error_code:R.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u670D\u52A1\u5668\u5F02\u5E38'};t.body=a});case 5:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports=(0,o.default)({},'GET music_163/:id',O)}).call(t,'/')},function(e){e.exports=require('http')},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}var l,o=a(6),d=r(o),s=a(0),n=r(s),u=a(1),i=r(u),p=a(3),f=a(7),c=a(8).Admin,_=a(15),R=a(4),E=a(12),m=a(73),y=m.RegisterValidator,x=m.LoginValidator,O=function(){var e=(0,i.default)(n.default.mark(function e(t){var a,r,l,o,d,s,u,i,m,x,O,h,g,S,N,T,b,A,k,C,v,I,w,D,V;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new y().validate(t);case 2:return a=e.sent,r=t.data,l=r.name,o=void 0===l?null:l,d=r.role_id,s=void 0===d?null:d,u=r.email,i=void 0===u?null:u,m=r.password,x=void 0===m?null:m,O=r.phone,h=void 0===O?null:O,g=r.qq,S=void 0===g?null:g,N=r.sex,T=void 0===N?null:N,b=r.content,A=void 0===b?null:b,k=r.status,C=void 0===k?0:k,v=r.create_time,I=void 0===v?f.time():v,w=r.update_time,D=void 0===w?f.time():w,e.next=6,c.findOne({where:{name:o}});case 6:if(V=e.sent,!V){e.next=9;break}throw new R.erroeException(p.ERROR_CODE.CHECK_ALREADY_EXISTS,'\u8BE5\u7528\u6237\u5DF2\u5B58\u5728');case 9:return e.next=11,c.create({name:o,role_id:s,email:i,password:x,phone:h,qq:S,sex:T,content:A,status:C,create_time:I,update_time:D}).then(function(e){t.body=E.success(e)}).catch(function(e){throw new R.erroeException(p.ERROR_CODE.INTERNAL_SERVER_ERROR,_.validation(e))});case 11:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,i.default)(n.default.mark(function e(t){var a;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new x().validate(t);case 2:return a=e.sent,e.next=5,c.findByPk(a.get('query.id')).then(function(e){t.body=E.success(e)}).catch(function(e){throw new R.erroeException(p.ERROR_CODE.INTERNAL_SERVER_ERROR,_.validation(e))});case 5:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports=(l={},(0,d.default)(l,'POST test/register',O),(0,d.default)(l,'GET test/info',h),l)},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}var l=a(17),o=r(l),d=a(11),s=r(d),n=a(20),u=r(n),i=a(18),p=r(i),f=a(19),c=r(f),_=a(27),R=_.XValidator,E=_.Rule,m=function(e){function t(){(0,s.default)(this,t);var e=(0,p.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return e.name=[new E('isNotEmpty','\u6635\u79F0\u4E0D\u53EF\u4E3A\u7A7A'),new E('isLength','\u6635\u79F0\u957F\u5EA6\u5FC5\u987B\u57282~10\u4E4B\u95F4',2,10)],e.email=[new E('isOptional'),new E('isEmail','\u7535\u5B50\u90AE\u7BB1\u4E0D\u7B26\u5408\u89C4\u8303\uFF0C\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1')],e.password=[new E('matches','\u5BC6\u7801\u957F\u5EA6\u5FC5\u987B\u57286~22\u4F4D\u4E4B\u95F4\uFF0C\u5305\u542B\u5B57\u7B26\u3001\u6570\u5B57\u548C _ ',/^[A-Za-z0-9_*&$#@]{6,22}$/)],e.confirm_password=new E('isNotEmpty','\u786E\u8BA4\u5BC6\u7801\u4E0D\u53EF\u4E3A\u7A7A'),e}return(0,c.default)(t,e),(0,u.default)(t,[{key:'validateConfirmPassword',value:function(e){if(!e.body.password||!e.body.confirm_password)return[!1,'\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165'];var t=e.body.password===e.body.confirm_password;return t?t:[!1,'\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165']}}]),t}(R),y=function(e){function t(){(0,s.default)(this,t);var e=(0,p.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return e.id=[new E('isNotEmpty','ID\u4E0D\u53EF\u4E3A\u7A7A')],e}return(0,c.default)(t,e),t}(R);e.exports={RegisterValidator:m,LoginValidator:y}},function(e){e.exports=require('koa-router')},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}var l=a(0),o=r(l),d=a(9),s=r(d),n=a(1),u=r(n),i=a(26),p=a(3),f=a(5),c=a(4),_=a(7);e.exports=function(){return function(){var e=(0,u.default)(o.default.mark(function e(t,a){var r,l,d,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.header.access_token,l=t.header.app_name,d='access_token\u4E0D\u5408\u6CD5',e.prev=3,'DOS'==l&&r&&(n=i.verify(r,f.secretKey)),e.next=14;break;case 7:if(e.prev=7,e.t0=e['catch'](3),'TokenExpiredError'!=e.t0.name){e.next=13;break}throw new c.erroeException(p.ERROR_CODE.ACCOUNT_CODE_EXPIRED);case 13:throw new c.erroeException(p.ERROR_CODE.NO_ACCESS_TOKEN);case 14:return t.auth=(0,s.default)({},n),e.next=17,a();case 17:case'end':return e.stop();}},e,this,[[3,7]])}));return function(){return e.apply(this,arguments)}}()}}]);